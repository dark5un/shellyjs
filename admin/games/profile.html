<html xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html">
<head>
<title>Lobby</title>
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.2/themes/smoothness/jquery-ui.css" />
    <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
    <script src="http://code.jquery.com/ui/1.10.2/jquery-ui.js"></script>

    <script src="/static/js/jquery.cookie.js"></script>
    <script src="/static/js/ba-debug.js"></script>
    <script src="/static/js/reconnecting-websocket.js"></script>
    <script src='/static/js/fastclick.js'></script>
    <script src='common.js'></script>

    <link rel="stylesheet" type="text/css" href="/static/css/shadmin.css">
    <link rel="stylesheet" type="text/css" href="/static/css/shgame.css">

    <script language="javascript">
var Env = {{{EnvJson}}};

function resetProfileSpans() {
    var saveData = {};
    $(".profileEditSpan").replaceWith(function () {
        var editId = $(this).attr("id");
        var value = $(this).val();
        saveData[editId] = value;
        Env.user[editId] = value;
        $span = $("<span/>");
        $span.attr("id", editId);
        $span.addClass("profileEditSpan");
        $span.text(Env.user[editId]);
        return $span;
    });
    $("#editProfile").css("display", "block");
    $("#saveProfile").css("display", "none");
    $("#cancelProfile").css("display", "none");
    return saveData;
}

$(init);
function init() {
    $("#shSystem").text("Example");
    $("#shSubTitle").text("Profile");

    window.addEventListener('load', function () {
        new FastClick(document.body);
    }, false);

    if (typeof (Env.user.email) !== "undefined" && Env.user.email.length > 0) {
        $(".anonymousDiv").css("display", "none");
    } else {
        $("#emailRow").css("display", "none");
    }

    $("#saveProfile").css("display", "none");
    $("#cancelProfile").css("display", "none");

    $("#editProfile").click(function () {
        $(".profileEditSpan").replaceWith(function () {
            var editId = $(this).attr("id");
            $input = $("<input/>");
            $input.attr("id", editId);
            $input.addClass("profileEditSpan");
            $input.val(Env.user[editId]);
            return $input;
        });
        $("#editProfile").css("display", "none");
        $("#saveProfile").css("display", "block");
        $("#cancelProfile").css("display", "block");
    });

    $("#cancelProfile").click(function () {
        resetProfileSpans();
    });

    $("#saveProfile").click(function () {
        var saveData = resetProfileSpans();
        console.log(saveData);
        var res = sendRestCmd("user.set", {user: saveData}, function (error, data) {
            if(!error) {
                $("#shUserNameSpan").text(data.data.name);
            }
        });
    });
}
</script>
    <style>
        .anonymousDiv {
            width: 500px;
        }
        .profileInfoDiv {
            width: 500px;
        }
        #profileContent {
            height: 200px;
        }

        .userTd {
            text-align: right;
        }
    </style>
</head>
<body>
{{> header}}
{{> gameNav}}

<div id="errorMessage" style="display:none;width:100%;background:pink;color:red;">error</div>

<div class="gameBoxDiv anonymousDiv" style="float:left;">
    <div class="gameBoxHeaderDiv">Anonymous Account</div>
    <div class="gameBoxInnerDiv">
        <p>You are currently using an anonymous account.</p>
        <p>Your information will not transfer to other devices and may be lost if you clear your cookies.</p>
        <p>Please register below to avoid these issues.</p>
        <button id="registerNow" style="float:right">register</button>
    </div>
</div>

<div class="profileInfoDiv gameBoxDiv" style="float:left;">
    <div class="gameBoxHeaderDiv">Profile Information</div>
    <div id="profileContent" class="gameBoxInnerDiv">
        <table>
            <tr><td class="userTd">user id:</td><td><span id="uid">{{Env.user.uid}}</span></td></tr>
            <tr id="emailRow"><td class="userTd">email:</td><td><span id="email">{{Env.user.email}}</span></td></tr>
            <tr><td class="userTd">name:</td><td><span id="name" class="profileEditSpan">{{Env.user.name}}</span></td></tr>
            <tr><td class="userTd">gender:</td><td><span id="gender" class="profileEditSpan">{{Env.user.gender}}</span></td></tr>
            <tr><td class="userTd">age:</td><td><span id="age" class="profileEditSpan">{{Env.user.age}}</span></td></tr>
            <tr><td class="userTd">token:</td><td><span id="token">{{Env.token}}</span></td></tr>
        </table>
        <button id="saveProfile" style="float:right">save</button>
        <button id="editProfile" style="float:right">edit</button>
        <button id="cancelProfile" style="float:right">cancel</button>
    </div>
</div>
<div style="clear:both"></div>

<div class="messageLogDiv gameBoxDiv">
    <div class="gameBoxHeaderDiv"<b>Message Log</b></div>
    <div id="messageLog" class="gameBoxInnerDiv" readonly></div>
</div>

{{> footer}}
</body>
</html>