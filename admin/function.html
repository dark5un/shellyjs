<html>
<head>
<title>Raw function editor</title>
    <script src="/static/js/jquery-1.7.1.min.js"></script>
    <script src="/static/js/ba-debug.js"></script>

    <link rel="stylesheet" type="text/css" href="/static/jsoneditor-2.0.0/jsoneditor.css">
    <script type="text/javascript" src="/static/jsoneditor-2.0.0/jsoneditor.js"></script>
    <style type="text/css">
        #jsoneditor {
            width: 300px;
            height: 400px;
            float: left;
        }
        #jsonResp {
            width: 500px;
            height: 400px;
            float:right;
        }
        body {
            font-family:verdana,arial,sans-serif;
            font-size:10pt;
            margin:30px;
        }
        .nameCell {
            font-weight: bold;
            width: 100px;
        }
    </style>
    <script language="javascript">
        var Env = new Object();
        Env = {{{params}});


        function initParams(sendEdit, respEdit)
        {
            var cmd = Env.module + "." + Env.function;
            var input = {cmd:cmd};

            $('#moduleName').text(Env.module);
            $('#functionName').text(Env.function);
            var funcInfo = Env.functions[Env.function];
            var paramInfo = "";
            console.log(funcInfo);
            for (key in funcInfo.params)
            {
                paramInfo += key + "=" + funcInfo.params[key].dtype + " ";
                input[key] = '';
            }
            $('#functionParams').text(paramInfo);
            sendEdit.set(input);
            respEdit.set();
        }


        $(init);
        function init()
        {
            var container = document.getElementById("jsoneditor");
//    var editor = new jsoneditor.JSONEditor(container);
            var editor = new jsoneditor.JSONFormatter(container);
            var respContainer = document.getElementById("jsonResp");
            var respEdit = new jsoneditor.JSONFormatter(respContainer);

            initParams(editor, respEdit);

            var cmd = Env.module + "." + Env.function;
            var input = {cmd:cmd};

            $('#moduleName').text(Env.module);
            $('#functionName').text(Env.function);
            var funcInfo = Env.functions[Env.function];
            var paramInfo = "";
            console.log(funcInfo);
            for (key in funcInfo.params)
            {
                paramInfo += key + "=" + funcInfo.params[key].dtype + " ";
                input[key] = '';
            }
            $('#functionParams').text(paramInfo);
            editor.set(input);


            $('#callFunction').click(function() {
                var cmd = editor.get();
                $.ajax
                        ({
                            type: "POST",
                            url: 'http://localhost:5101/api',
                            dataType: 'json',
                            async: false,
                            //json object to sent to the authentication url
//                            data: JSON.stringify({cmd: "reg.login"}),
                            data: cmd,
                            success: function (data, status) {
                                respEdit.set(data);
                            }
                        })
            });
            $('#resetFunction').click(function() {
                initParams(editor, respEdit)
            });
        }
    </script>
</head>
<body>
<table>
    <tr>
        <td class="nameCell">module:</td><td><div id="moduleName">{module_name}</div></td>
        <td style="width:100px"></td><td></td>
    </tr>
    <tr>
        <td class="nameCell">function:</td><td><div id="functionName">{function_name}</div></td>
        <td class="nameCell" style="text-align:right;">params:</td><td><div id="functionParams">{function_params}</div></td>
    </tr>
</table>
<p>
    <button id="callFunction">call function</button>
    <button id="resetFunction">reset</button>
</p>
<div id="jsoneditor"></div>
<div id="jsonResp"></div>

<script type="text/javascript" >
    // create the editor
</script>

</body>
</html>